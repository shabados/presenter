{{define "displayPage"}}
<!DOCTYPE html>
<html>
	<head>
		{{template "header"}}
		<script>
			function updateShabad() {
				$.ajax({
					url : server+"/getJSON",
					async: true,
					dataType: "json",
					success : function (data) {
						var body = "<div class='shabad' data-shabadid="+data.shabadID+">";
						$.each(data.shabad, function(key,value){
							body = body+"<div id="+value.PK+" class='line'><div><div class=\"gurmukhifont\">"+value.gurmukhi+"</div>";
							body = body+"<p class=\"translation\">"+value.translation+"</p>";
							body = body+"<p class=\"darpan\">"+value.darpan+"</p>";
							body = body+"<div class=\"transliteration\">"+value.transliteration+"</div>";
							body = body+"</div></div>"; //closes opening div
						})
						if (data.shabadID != 0) {
							body += `<svg height="8.5vh" viewBox="0 0 144.51883 39.125126" xmlns="http://www.w3.org/2000/svg" class="eof">
 <g transform="translate(-724.88 -598.51)">
  <path d="m841.25884,598.51403c-.0615-.00248-.187.03305-.25.03125-4.4119-.1258-12.414,1.19225-20.3437,3.375-8.3322,2.29354-16.3542,6.05099-25.4063,8.9375-4.0878-1.92533-8.2447-3.76165-12.4062-5.25-7.2467-2.5917-14.2508-4.28125-19.75-4.28125-1.3667,0-2.7011.08596-4,.25s-2.5774.40771-3.7813.71875c-2.4078.62209-4.6061,1.51712-6.4687,2.625-3.3231,1.97646-5.5339,4.66403-6,7.6875-1.8957.06323-3.7037.1633-5.2188.34375-3.5927.42788-6.1908,1.14903-8.0625,2.09375-.9358.47236-1.6966.99845-2.3125,1.5625-2.4637,2.25619-2.375,5.09484-2.375,6.84375 0,1.17621.5848,2.48927 1.6563,3.9375s2.6672,2.99151 4.8437,4.40625c1.0883.70737 2.3059,1.38397 3.6875,2 2.7633,1.23206 6.1253,2.22532 10.125,2.75 1.9999.26234 4.1753.40625 6.5.40625 2.1877,0 4.6181-.23206 7.1563-.5625 8.3229-1.08355 18.1035-3.68446 27.0312-6.46875 1.5017-.46833 2.5932-.87335 4.0313-1.34375 1.2248.55655 2.4737,1.06985 3.6875,1.625 5.7943,2.65027 11.4315,5.23193 16.6875,7.4375l.625-1.46875c-5.2191-2.19011-10.8593-4.78607-16.6563-7.4375-.6892-.31524-1.4001-.62116-2.0937-.9375 8.625-2.88601 16.0662-5.5981 18.3437-6.40625 .2353-.08348 1.2057-.42447 1.5-.53125 4.7531,2.1442 9.7417,4.22891 14.7188,5.96875 4.098,1.43254 8.041,2.64029 11.5312,3.53125s6.5264,1.46446 8.7813,1.5625c4.4936.19538 10.1122-1.16356 14.625-3.625 1.1281-.61536 2.1707-1.3057 3.125-2.0625s1.7952-1.57187 2.5-2.46875c1.4093-1.79377 2.2492-3.90711 2.0937-6.1875-.2974-4.36255-2.6298-7.33764-5.9687-9.09375-2.1783-1.14561-4.8514-1.70565-7.6563-2.0625-.6365-2.78405-2.0858-4.74473-4.2187-5.90625-1.5048-.81945-3.3426-1.26739-5.375-1.5625-1.5934-.30889-3.1613-.42001-4.5938-.40625-.0979.00094-.2161-.03334-.3125-.03125zm0,1.59375h.0313c1.7583.07703 3.284.2534 4.7187.46875 1.3.26378 2.6016.61692 3.75,1.1875 1.9555.97156 3.4908,2.37856 4.25,4.5-.9474-.07673-1.8357-.2609-2.8125-.28125-14.76,1.50859-28.7791,6.09808-43.0937,11.21875-1.314-.6531-2.8543-1.2893-4.0313-1.9375-.9798-.53957-2.1038-1.02975-3.125-1.5625 .2451-.10242.7868-.28206 1-.375 3.6374-1.58552 11.3406-4.85979 19.2188-7.75 7.862-2.88429 15.9753-5.37165 20.0937-5.46875zm-78.1562,2.8125c1.2906,0 2.6769.08493 4.1562.28125s3.031.5069 4.6563.875c6.6119,1.49752 14.2323,4.31367 21.4687,7.625-4.351,2.02377-8.228,3.92437-13.75,6.1875-1.9557.80151-3.6747,1.34558-5.5625,2.0625-2.0856-.83072-4.1688-1.67429-6.2187-2.40625-5.7735-2.06144-11.3673-3.66897-16.5625-4.46875-2.3699-.36481-4.6292-.50465-6.8125-.5 .3364-1.63434 1.2738-3.24059 2.9062-4.65625 .6699-.58095 1.4552-1.11509 2.3125-1.625 1.7146-1.01982 3.757-1.88086 6.0313-2.46875s4.7773-.90625 7.375-.90625zm86.0937,6.90625c.2946-.01319.5822-.00545.8438,0 1.507.0314 2.9528.11729 4.4062.1875-.0262.37619.0027.75116-.0625,1.125-.3007,1.7232-1.0049,3.40616-2,4.9375-.4975.76567-1.0893,1.48227-1.7187,2.15625-1.2589,1.34796-2.7292,2.48248-4.3125,3.28125-.7918.39939-1.6148.71411-2.4375.9375s-1.6486.35342-2.4688.375c-1.7052.04487-3.1768-.16041-4.4062-.5-1.1831-.32676-2.1479-.78877-2.9063-1.3125 1.4414-.26547 2.5624-1.51348 2.5625-3.03125 0-1.71041-1.4146-3.09376-3.125-3.09375-.157,0-.2868.00869-.4375.03125-.2817-.02489-.5895-.01045-.9062.03125-.8906.26386-1.7329,1.1824-1.8438,2.625-.0621.80655.158,1.63385.625,2.4375s1.1891,1.58335 2.125,2.25 2.105,1.23977 3.5,1.625 2.995.5799 4.8438.53125c.9568-.02518 1.9091-.15543 2.8437-.40625s1.8671-.61724 2.75-1.0625 1.7293-.98523 2.5313-1.59375 1.5583-1.29066 2.25-2.03125 1.3224-1.52663 1.875-2.375 1.028-1.75919 1.4062-2.6875 .6436-1.89459.8125-2.875c.0747-.43333.0336-.87291.0625-1.3125 2.2961.1632 4.474.43217 6.25,1 1.6286.5207 2.9369,1.27103 3.875,2.3125s1.5258,2.39919 1.6563,4.3125c.0625.91737-.0766,1.77943-.375,2.625s-.7617,1.65678-1.375,2.4375-1.3784,1.52737-2.25,2.21875-1.8483,1.32917-2.9063,1.90625c-2.116,1.15417-4.5367,2.06989-6.9375,2.65625s-4.7885.83936-6.8437.75c-2.0473-.08901-4.9698-.62567-8.4063-1.5s-7.3754-2.08002-11.4375-3.5c-4.3986-1.53763-8.8851-3.31443-13.1562-5.1875 3.7156-1.36427 8.5603-3.19735 15.0937-5.34375 7.5845-2.49173 15.5806-4.73958 20-4.9375zm-104.8437,4.34375c6.6775-.03683 14.5606,1.92495 22.9375,4.90625 1.4869.5292 3.0205,1.16432 4.5312,1.75-1.4163.51556-3.0257,1.1758-4.3125,1.59375-1.4778.47998-2.7689.84632-4,1.15625-1.4913.26383-3.4798.75-4.3437.75-3.5544,0-7.3663-1.26658-10.2188-3.25-2.6871-1.86841-4.3939-4.34462-4.5937-6.90625zm-1.625.03125c.0998,1.53163.576,2.99201 1.4375,4.3125 .9567,1.46661 2.3083,2.78578 3.875,3.875s3.3841,1.98269 5.2812,2.59375 3.8798.9375 5.8438.9375c2.0371,0 5.1829-.59878 8.9687-1.53125 2.2513-.55451 4.9127-1.38084 7.4688-2.125 .1365.0559.2696.10003.4062.15625 2.9586,1.21755 5.904,2.61631 8.875,3.9375-2.0393.90217-2.8227,1.30674-5.0937,2.21875-8.8664,3.5605-19.1188,6.78125-28.0938,6.78125-2.258,0-4.3531-.15347-6.2812-.40625s-3.7014-.61539-5.3125-1.0625c-3.2225-.89422-5.8117-2.11663-7.8438-3.4375-1.0161-.66043-1.8879-1.32115-2.625-2s-1.3428-1.36508-1.8125-2c-.9394-1.26985-1.3439-2.39924-1.3437-3 0-.90253-.0323-1.8827.1875-2.84375s.698-1.90642 1.6875-2.8125c.4946-.45304 1.14-.90002 1.9687-1.3125 1.6574-.82495 4.0447-1.51927 7.5-1.9375 1.4056-.17014 3.1313-.27887 4.9063-.34375zm56.1875.28125c1.4501.73671 3.0071,1.43427 4.375,2.1875 .7615.41942 1.7761.82896 2.5937,1.25-6.3498,2.57734-12.2442,5.01301-19,7.5625-2.955-1.32344-5.8833-2.66798-8.8437-3.90625 .9236-.27871 1.7273-.46017 2.6562-.75 7.2607-2.26534 13.8279-4.61876 18.2188-6.34375z"/>
 </g>
</svg>`;
						}
						$('div.body').html(body+"</div>");
					}
				});
			}

			function updateDisplay() {
				$.ajax({
					url : server+"/getLineID",
					async: true,
					dataType: "json",
					success : function (data) {
						var shabadID = data.shabadID;
						if (shabadID != $('div.shabad').data("shabadid")) {
							updateShabad();
						} else {
							var PK = data.PK;
							if (!$("#"+PK).hasClass('active')) {
								$('.active').removeClass('active');
								$("#"+PK).addClass('active');
							}
							
							// var scrollToID = Number(PK);
							// if (scrollToID > Number(firstLineID) && data.shabadID !== "adv") {
								// scrollToID = scrollToID - 1;
							// }
							// try {
							// 	var scrollPos = $erver+("#"+scrollToID).offset().top //+ $("#"+scrollToID+"> .gurmukhifont").height()/2 - $('#fader').height()/3;
							// } catch (e) {
							// 	console.log(scrollToID+": "+$("#999999999999")+" /// "+e)
							// }
							// if (scrollPos < 0) {scrollPos = 0;}
							// scroll(scrollPos);
						}
						if (shabadID != 0) {
							$("#watermark").hide();
						} else {
							$("#watermark").show();
						}
						
						// for non-development set to 30ish milliseconds
						setTimeout(updateDisplay, 30);
					}
				});
			}
			
			$(window).load(function() {
    	    	dhm = $("#iframesHuMsg");
    	    	dhm.hide();

    			$("iframe").show();
				updateDisplay();

				$('iframe').on('DOMMouseScroll mousewheel', function(ev) {
					var $this = $(this),
						scrollTop = this.scrollTop,
						scrollHeight = this.scrollHeight,
						height = $this.height(),
						delta = (ev.type == 'DOMMouseScroll' ?
							ev.originalEvent.detail * -40 :
							ev.originalEvent.wheelDelta),
						up = delta > 0;

					var prevent = function() {
						ev.stopPropagation();
						ev.preventDefault();
						ev.returnValue = false;
						return false;
					}

					if (!up && -delta > scrollHeight - height - scrollTop) {
						// Scrolling down, but this will take us past the bottom.
						$this.scrollTop(scrollHeight);
						return prevent();
					} else if (up && delta > scrollTop) {
						// Scrolling up, but this will take us past the top.
						$this.scrollTop(0);
						return prevent();
					}
				});

				// $("#navibar").hover(function(e) {
					// $(this).children("div").stop().slideDown('fast');
					// event.preventDefault();
				// });
				// $("#navibar").mouseleave(function(e) {
					// $(this).children("div").slideUp('slow');
					// event.preventDefault();
				// });

				$("#hiddenIframePlusBox").click(function() {
					if (navWindow) {
						$('iframe').attr('src', navWindow.location.href);
						navWindow.close();
					}
					$('iframe').show();
				});

			});
			
			//forward all keys to the iframe
			$(document).keydown(function(e) {
				var iframe = $('iframe');
				iframe[0].contentWindow.focus();
				setTimeout(function() {iframe.trigger(e);}, 500);
			});

			var timer;
			var fadeInBuffer = false;

			$(document).mousemove(function () {
		        if (!fadeInBuffer) {
		            if (timer) {
		                clearTimeout(timer);
		                timer = 0;
		            }

		            $('html').css({
		                cursor: ''
		            });
		        } else {
		             $('div.hideCursor').css({
		                cursor: 'default'
		            });
					$('div#hiddenIframePlusBox').show();
					$('div#titlebar').show();
		            fadeInBuffer = false;
		        }

		        timer = setTimeout(function () {
		             $('div.hideCursor').css({
		                cursor: 'none'
		            });
					$('div#hiddenIframePlusBox').hide();
					$('div#titlebar').hide();
		            fadeInBuffer = true;
		        }, 2000)
		    });
		    $('div.hideCursor').css({
                cursor: 'default'
            });
			$('div#hiddenIframePlusBox').show();
			$('div#titlebar').show();

		</script>
		</head>
<html>
	<body class="presentation {{.Settings}}">
		{{template "dragBorders"}}
		{{template "titlebarCloseable" .}}
		<div id="help-screen">
			<h1>Keyboard Shortcuts</h1>
			<div class="dl">
    			<dl>
    				<dt>(?) Shift+/</dt>
    				<dd>Toggle This Menu</dd>
    				<dt>Ctrl+F / F11</dt>
    				<dd>Toggle Fullscreen</dd>
    				<dt>Ctrl+R</dt>
    				<dd>Refresh</dd>
    				<dt>Ctrl+N</dt>
    				<dd>New Controller</dd>
    			</dl>
    			<dl>
    				<dt>Ctrl+H</dt>
    				<dd>Toggle Controller</dd>
    				<dt>Ctrl+P / Ctrl+,</dt>
    				<dd>Menu</dd>
    				<dt>Ctrl+Left Arrow</dt>
    				<dd>History Back</dd>
    				<dt>Ctrl+Right Arrow</dt>
    				<dd>History Forward</dd>
    			</dl>
    			<dl>
    				<dt>Ctrl+/</dt>
    				<dd>Search</dd>
    				<dt>Ctrl+Y</dt>
    				<dd>History</dd>
    				<dt>Ctrl+B</dt>
    				<dd>Bookmarks</dd>
    				<dt>Esc</dt>
    				<dd>Clear Display</dd>
    			</dl>
    		</div>
		</div>
        <!--<div id="keyboardHelp">
          <div class="col1">
        	<div class="row1">
        	  <div class="gurmukhifont"><span>a</span><span>A</span><span>e</span><span>s</span><span>h</span></div>
        	  <div><span>a</span><span>A</span><span>e</span><span>s</span><span>h</span></div>
        	</div>
        	<div class="row2">
        	  <div class="gurmukhifont"><span>k</span><span>K</span><span>g</span><span>G</span><span>|</div>
        	  <div><span>k</span><span>K</span><span>g</span><span>G</span><span>|</div>
        	</div>
        	<div class="row3">
        	  <div class="gurmukhifont"><span>c</span><span>C</span><span>j</span><span>J</span><span>\</div>
        	  <div><span>c</span><span>C</span><span>j</span><span>J</span><span>\</div>
        	</div>
        	<div class="row4">
        	  <div class="gurmukhifont"><span>t</span><span>T</span><span>f</span><span>F</span><span>x</div>
        	  <div><span>t</span><span>T</span><span>f</span><span>F</span><span>x</div>
        	</div>
          </div>
          <div class="col2">
        	<div class="row5">
        	  <div class="gurmukhifont"><span>q</span><span>Q</span><span>d</span><span>D</span><span>n</div>
        	  <div><span>q</span><span>Q</span><span>d</span><span>D</span><span>n</div>
        	</div>
        	<div class="row6">
        	  <div class="gurmukhifont"><span>p</span><span>P</span><span>b</span><span>B</span><span>m</div>
        	  <div><span>p</span><span>P</span><span>b</span><span>B</span><span>m</div>
        	</div>
        	<div class="row7">
        	  <div class="gurmukhifont"><span>X</span><span>r</span><span>l</span><span>v</span><span>V</div>
        	  <div><span>X</span><span>r</span><span>l</span><span>v</span><span>V</div>
        	</div>
          </div>
          <div class="clear"></div>
		</div><!-- -->
		<div id="watermark">Shabad OS</div>
		<div class="body"><div class="shabad" data-shabadid="0"><div id="0" class="line"><div><div class="gurmukhifont"></div><p class="translation"></p></div></div></div></div>
		<div class="hideCursor" style="width: 100%; height: 100%; background: none; z-index: 99; position: fixed; top: 0; left: 0;">
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
		</div>
		<iframe src="index" class="iframe"></iframe>
		<div id="iframesHuMsg"></div>
		<div id="hiddenIframePlusBox" style="z-index: 999;"><i class="fa fa-fw fa-plus" aria-hidden="true"></i></div>
	</body>
</html>
{{end}}
